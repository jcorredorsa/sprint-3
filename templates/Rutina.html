{% extends "base.html" %} 
{% block title %}Rutinas{% endblock %}
{% block menu_rutinas_active %}active{% endblock %}

{% block content %}

{# 1. Determinar tipo desde la URL, por defecto Gimnasio #}
{% set tipo = request.args.get('tipo', 'Gimnasio') %}

<h1>Rutinas para {{ deporte }} - Nivel {{ nivel }}</h1>

<p><strong>Complicación registrada:</strong> {{ complicacion if complicacion else "Ninguna" }}</p>

<!-- 2. Botones para cambiar tipo de sesión -->
<form method="get" style="margin-bottom:20px;">
    <button name="tipo" value="Gimnasio">Ver rutina de gimnasio</button>
    {% if deporte == "Natacion" %}
        <button name="tipo" value="Piscina">Ver rutina de piscina</button>
    {% else %}
        <button name="tipo" value="Aire">Ver rutina de aire libre</button>
    {% endif %}
</form>

{# 3. Filtrar rutinas según el tipo seleccionado #}
{% set filtradas = [] %}

{% for r in rutinas %}
    {% set t = r.tipo_sesion.lower() %}

    {# Gimnasio: cualquier rutina cuyo tipo contenga "gimnasio" #}
    {% if tipo == "Gimnasio" and "gimnasio" in t %}
        {% set _ = filtradas.append(r) %}

    {# Piscina (solo natación) #}
    {% elif tipo == "Piscina" and "piscina" in t %}
        {% set _ = filtradas.append(r) %}

    {# Aire libre / campo / pista: todo lo que NO es gimnasio ni piscina #}
    {% elif tipo == "Aire" and "gimnasio" not in t and "piscina" not in t %}
        {% set _ = filtradas.append(r) %}
    {% endif %}
{% endfor %}

<h2>
    {% if tipo == "Gimnasio" %}
        Rutinas de Gimnasio
    {% elif tipo == "Piscina" %}
        Rutinas de Piscina
    {% else %}
        Rutinas de Aire libre / Campo
    {% endif %}
</h2>

{# 4. Mostrar rutinas o mensaje si no hay #}
{% if filtradas|length == 0 %}
    <p>No hay rutinas de {{ tipo }} para este deporte/nivel.</p>
{% else %}

    {% for r in filtradas %}
        <div class="rutina-box" style="margin-bottom: 30px;">

            <h3>{{ r.titulo }}</h3>

            {% if r.imagen %}
                <img src="{{ url_for('static', filename='img/ejercicios/' ~ r.imagen) }}"
                     alt="{{ r.titulo }}"
                     class="rutina-img"
                     style="max-width: 300px; display:block; margin: 10px 0;">
            {% endif %}

            <p><strong>Descripción:</strong> {{ r.descripcion }}</p>
            <p><strong>Duración:</strong> {{ r.duracion }}</p>

            <p><strong>Pasos:</strong></p>
            <ul>
                {% for paso in r.pasos %}
                    <li style="margin-bottom: 10px;">
                        <strong>{{ paso.nombre }}</strong>{% if paso.detalle %}: {{ paso.detalle }}{% endif %}
                        {% if paso.gif %}
                        <br>
                        <img src="{{ url_for('static', filename='img/ejercicios/' ~ paso.gif) }}"
                             alt="{{ paso.nombre }}"
                             style="max-width: 200px; margin-top: 5px;">
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>

        </div>
    {% endfor %}

{% endif %}

<a href="{{ url_for('encuesta') }}">Volver a la encuesta</a>

{% endblock %}